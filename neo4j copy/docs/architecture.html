<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purple Fabric â€” Technical Architecture Document</title>
<style>
  :root {
    --purple: #6B21A8;
    --purple-light: #7C3AED;
    --purple-bg: #F5F3FF;
    --border: #E5E7EB;
    --text: #1F2937;
    --text-secondary: #6B7280;
    --bg: #FFFFFF;
    --code-bg: #F8F9FA;
    --success: #059669;
    --warning: #D97706;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: var(--text);
    line-height: 1.7;
    max-width: 1100px;
    margin: 0 auto;
    padding: 40px 32px;
    background: var(--bg);
  }
  h1 { font-size: 28px; color: var(--purple); margin-bottom: 8px; border-bottom: 3px solid var(--purple); padding-bottom: 12px; }
  h2 { font-size: 22px; color: var(--purple); margin-top: 48px; margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
  h3 { font-size: 17px; color: var(--purple-light); margin-top: 32px; margin-bottom: 12px; }
  p { margin-bottom: 12px; }
  .meta { color: var(--text-secondary); font-size: 14px; margin-bottom: 32px; }
  .meta strong { color: var(--text); }
  pre {
    background: #1E1E2E;
    color: #CDD6F4;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 12.5px;
    line-height: 1.5;
    margin: 16px 0;
    border: 1px solid #313244;
  }
  code {
    background: var(--code-bg);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 13px;
    color: var(--purple);
  }
  pre code { background: none; padding: 0; color: inherit; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 14px;
  }
  th {
    background: var(--purple-bg);
    color: var(--purple);
    font-weight: 600;
    text-align: left;
    padding: 10px 14px;
    border: 1px solid var(--border);
  }
  td {
    padding: 10px 14px;
    border: 1px solid var(--border);
    vertical-align: top;
  }
  tr:nth-child(even) td { background: #FAFAFA; }
  ul, ol { margin: 8px 0 16px 24px; }
  li { margin-bottom: 4px; }
  hr { border: none; border-top: 1px solid var(--border); margin: 40px 0; }
  .toc { background: var(--purple-bg); border: 1px solid var(--border); border-radius: 8px; padding: 20px 28px; margin: 24px 0; }
  .toc h3 { margin-top: 0; color: var(--purple); }
  .toc ol { margin: 8px 0 0 20px; }
  .toc li { margin-bottom: 4px; }
  .toc a { color: var(--purple); text-decoration: none; }
  .toc a:hover { text-decoration: underline; }
  @media print {
    body { max-width: 100%; padding: 20px; }
    pre { font-size: 10px; }
    h2 { page-break-before: always; }
  }
</style>
</head>
<body>

<h1>Purple Fabric â€” Technical Architecture Document</h1>
<div class="meta">
  <strong>Version:</strong> 3.0 &nbsp;|&nbsp;
  <strong>Date:</strong> February 2026 &nbsp;|&nbsp;
  <strong>Classification:</strong> Internal â€” Technical Leadership
</div>

<div class="toc">
<h3>Table of Contents</h3>
<ol>
  <li><a href="#exec">Executive Summary</a></li>
  <li><a href="#overview">System Architecture Overview</a></li>
  <li><a href="#databases">Database Responsibilities</a></li>
  <li><a href="#multitenant">Multi-Tenant Architecture</a></li>
  <li><a href="#auth">Authentication &amp; Authorization</a></li>
  <li><a href="#services">Two Independent Services: RAG &amp; KG Enrichment</a></li>
  <li><a href="#pipeline">Document Processing Pipeline</a></li>
  <li><a href="#sync">GraphDB â†’ Neo4j Sync</a></li>
  <li><a href="#agents">Agent Architecture</a></li>
  <li><a href="#unified">Unified Agent Query Pipeline</a></li>
  <li><a href="#memory">Agent Long-Term Memory</a></li>
  <li><a href="#vkg">Virtual Knowledge Graph (VKG)</a></li>
  <li><a href="#versioning">Ontology Versioning</a></li>
  <li><a href="#viz">Entity Visualization</a></li>
  <li><a href="#deploy">Deployment Architecture</a></li>
  <li><a href="#client">Client Architecture</a></li>
  <li><a href="#deps">Service Dependency Graph</a></li>
  <li><a href="#security">Security Architecture</a></li>
  <li><a href="#jobs">Background Job Processing</a></li>
  <li><a href="#decisions">Key Design Decisions</a></li>
</ol>
</div>

<hr>

<!-- Section 1: Executive Summary -->
<h2 id="exec">1. Executive Summary</h2>
<p>Purple Fabric is an enterprise-grade, multi-tenant knowledge graph platform that combines semantic web technologies (OWL/RDF/SPARQL), property graph analytics (Neo4j), vector embeddings (Redis), AI-powered document processing (AWS Bedrock / OpenAI / Ollama), and federated SQL querying (Trino) into a unified system for automated knowledge extraction, ontology management, and intelligent conversational agents.</p>
<p>The platform ingests structured (CSV/Excel) and unstructured (PDF/text) documents through two independent services: <strong>Service A (RAG)</strong> handles chunking and embedding at upload time for immediate semantic search, while <strong>Service B (KG Enrichment)</strong> optionally extracts entities and relationships using LLM-powered pipelines, stores them as RDF triples in GraphDB with full ontology conformance, and syncs to Neo4j for graph analytics.</p>
<p>Conversational AI agents provide the primary query interface. Each agent is configured with specific data sources (document folders, ontologies, VKG databases) and maintains long-term memory across sessions. When a user asks a question, the <strong>Unified Agent Query Pipeline</strong> uses an LLM-based planner to route the query across up to four parallel retrieval channels â€” vector search, ontology-guided graph traversal, federated SQL via VKG, and memory recall â€” then fuses the results into a single coherent response.</p>
<p>Ontologies stored in GraphDB serve as the semantic backbone: they guide Neo4j graph queries, inform VKG SQL generation, and structure entity extraction. The <strong>Virtual Knowledge Graph (VKG)</strong> layer federates queries across external databases via Trino, using ontology-to-table mappings to translate natural language into SQL without requiring users to know the underlying schema.</p>

<hr>

<!-- Section 2: System Architecture Overview -->
<h2 id="overview">2. System Architecture Overview</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT (React SPA)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Agents   â”‚ â”‚   Data    â”‚ â”‚ Ontology  â”‚ â”‚   Jobs    â”‚ â”‚  Admin   â”‚ â”‚
â”‚  â”‚  (Chat)   â”‚ â”‚Management â”‚ â”‚  Manager  â”‚ â”‚  Monitor  â”‚ â”‚  Panel   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚             â”‚             â”‚            â”‚
         â–¼              â–¼             â–¼             â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NGINX REVERSE PROXY (Port 80/443)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS.JS SERVER (Port 5002)                        â”‚
â”‚  â”Œâ”€â”€â”€ Middleware â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CORS â†’ JSON â†’ CSRF â†’ Rate Limiter â†’ JWT Auth â†’ RBAC â†’ Tenant   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€ API Routes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /api/auth  /api/agents/*  /api/owl  /api/ontology/*  /api/admin â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€ Service Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GraphRAGService  MemoryService  VKGQueryService  LLMService     â”‚  â”‚
â”‚  â”‚ VectorStoreService  ExtractionService  OWLOntologyService       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚              â”‚              â”‚
             â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     GraphDB      â”‚ â”‚    Neo4j     â”‚ â”‚      Redis       â”‚ â”‚    Trino    â”‚
â”‚ (Ontology/Schema)â”‚ â”‚(Entity Query)â”‚ â”‚(Vectors+Memory)  â”‚ â”‚(Federated   â”‚
â”‚  Port 7200       â”‚ â”‚  Port 7687   â”‚ â”‚  Port 6379       â”‚ â”‚ SQL) :8080  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<hr>

<!-- Section 3: Database Responsibilities -->
<h2 id="databases">3. Database Responsibilities (Separation of Concerns)</h2>

<h3>3.1 GraphDB (Ontology &amp; Schema Store)</h3>
<table>
  <tr><th>Concern</th><th>Details</th></tr>
  <tr><td>Role</td><td>Ontology definitions, schema management, VKG mapping annotations</td></tr>
  <tr><td>Format</td><td>RDF triples in Turtle (TTL) syntax</td></tr>
  <tr><td>Query</td><td>SPARQL 1.1</td></tr>
  <tr><td>Isolation</td><td>Named graphs per tenant/workspace/ontology</td></tr>
  <tr><td>NOT used for</td><td>Direct answer generation â€” GraphDB is never queried for answers</td></tr>
</table>
<p>GraphDB provides the semantic backbone that guides all other query engines. It is the authoritative store for ontology definitions, which are consumed by Neo4j (for ontology-guided Cypher generation) and VKG (for ontology-to-SQL translation).</p>
<p>Named graph IRI patterns:</p>
<pre><code>Global ontology:     http://example.org/graphs/global/ontology/{ontologyId}
Workspace schema:    http://purplefabric.ai/graphs/tenant/{t}/workspace/{w}/schema
Workspace data:      http://purplefabric.ai/graphs/tenant/{t}/workspace/{w}/data
Audit graph:         http://purplefabric.ai/graphs/tenant/{t}/workspace/{w}/audit
Deprecated graph:    http://purplefabric.ai/graphs/tenant/{t}/workspace/{w}/deprecated</code></pre>

<h3>3.2 Neo4j (Entity Query Engine)</h3>
<table>
  <tr><th>Concern</th><th>Details</th></tr>
  <tr><td>Role</td><td>Query engine for entity/relationship data, guided by ontology from GraphDB</td></tr>
  <tr><td>Query</td><td>Cypher</td></tr>
  <tr><td>Sync</td><td>One-way from GraphDB via <code>GraphDBNeo4jSyncService</code></td></tr>
  <tr><td>Scoping</td><td><code>tenant_id</code> + <code>workspace_id</code> properties on every node</td></tr>
</table>

<h3>3.3 Redis (Vector Store + Memory + Cache + Queue)</h3>
<table>
  <tr><th>Concern</th><th>Details</th></tr>
  <tr><td>Role</td><td>Vector embeddings for RAG, agent long-term memory, staging area, cache, job queues</td></tr>
  <tr><td>Index</td><td>RediSearch HNSW (cosine similarity, 1024-dim)</td></tr>
  <tr><td>Persistence</td><td>AOF (append-only file)</td></tr>
</table>
<pre><code>chunk:{chunkId}                â†’ Vector embedding + text + metadata (permanent)
doc:{docId}                    â†’ Document metadata (permanent)
staged:{docId}                 â†’ Staging data for KG enrichment (persistent, no TTL)
colmap:{workspaceId}:{ontId}   â†’ Column mapping configuration (permanent)
agent:{tenantId}:{wsId}:{id}   â†’ Agent configuration JSON (permanent)
agent_mem:{agentId}:{memId}    â†’ Individual memory entries (permanent)
agent_core:{agentId}           â†’ Core memory block (permanent)
agent_session:{agentId}:{sid}  â†’ Conversation session messages (permanent)
session:{token}                â†’ User session data
bull:*                         â†’ BullMQ job queues</code></pre>

<h3>3.4 Trino (Federated SQL Engine)</h3>
<table>
  <tr><th>Concern</th><th>Details</th></tr>
  <tr><td>Role</td><td>Federated SQL queries across external databases, guided by ontology mappings</td></tr>
  <tr><td>Query</td><td>SQL (ANSI)</td></tr>
  <tr><td>Catalogs</td><td>Configured per workspace (MySQL, PostgreSQL, etc.)</td></tr>
  <tr><td>Scoping</td><td>Workspace-level catalog isolation</td></tr>
</table>
<p>Trino is accessed exclusively through the VKG pipeline. It never receives direct user queries â€” the VKG service translates natural language to SQL using ontology mappings from GraphDB.</p>

<hr>

<!-- Section 4: Multi-Tenant Architecture -->
<h2 id="multitenant">4. Multi-Tenant Architecture</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GLOBAL ONTOLOGY LIBRARY                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Resume  â”‚ â”‚  Legal   â”‚ â”‚ Banking  â”‚ â”‚   AML    â”‚          â”‚
â”‚  â”‚ Ontology â”‚ â”‚ Contract â”‚ â”‚ Ontology â”‚ â”‚ Ontology â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚              (Read-only, shared across all tenants)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ fork / copy
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Tenant A      â”‚ â”‚    Tenant B      â”‚ â”‚    Tenant C      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Workspace 1  â”‚ â”‚ â”‚ â”‚ Workspace 1  â”‚ â”‚ â”‚ â”‚ Workspace 1  â”‚ â”‚
â”‚ â”‚ â€¢ Schema     â”‚ â”‚ â”‚ â”‚ â€¢ Schema     â”‚ â”‚ â”‚ â”‚ â€¢ Schema     â”‚ â”‚
â”‚ â”‚ â€¢ Data       â”‚ â”‚ â”‚ â”‚ â€¢ Data       â”‚ â”‚ â”‚ â”‚ â€¢ Data       â”‚ â”‚
â”‚ â”‚ â€¢ Agents     â”‚ â”‚ â”‚ â”‚ â€¢ Agents     â”‚ â”‚ â”‚ â”‚ â€¢ Agents     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p>Isolation is enforced at every layer:</p>
<ul>
  <li><strong>GraphDB:</strong> Separate named graphs per tenant/workspace</li>
  <li><strong>Neo4j:</strong> <code>tenant_id</code> + <code>workspace_id</code> on every node</li>
  <li><strong>Redis:</strong> Key prefixes include workspace/tenant IDs</li>
  <li><strong>Trino:</strong> Workspace-scoped catalog configurations</li>
  <li><strong>API:</strong> <code>X-Tenant-Id</code> and <code>X-Workspace-Id</code> headers required</li>
</ul>

<hr>

<!-- Section 5: Authentication & Authorization -->
<h2 id="auth">5. Authentication &amp; Authorization</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€â–¶â”‚  CSRF Check  â”‚â”€â”€â”€â”€â–¶â”‚  JWT Verify  â”‚â”€â”€â”€â”€â–¶â”‚   RBAC   â”‚
â”‚ (Bearer) â”‚     â”‚              â”‚     â”‚              â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<table>
  <tr><th>Role</th><th>Inherits</th><th>Key Permissions</th></tr>
  <tr><td><code>viewer</code></td><td>â€”</td><td>Read dashboards, use agents, read documents/entities</td></tr>
  <tr><td><code>member</code></td><td>viewer</td><td>Upload documents, run extractions, create agents</td></tr>
  <tr><td><code>manager</code></td><td>member</td><td>Manage ontologies, clear data, manage folders</td></tr>
  <tr><td><code>admin</code></td><td>manager</td><td>Manage users/tenants, system settings, LLM config</td></tr>
</table>

<hr>

<!-- Section 6: Two Independent Services -->
<h2 id="services">6. Two Independent Services: RAG &amp; KG Enrichment</h2>

<h3>Service A: RAG (Retrieval-Augmented Generation)</h3>
<p>Runs at upload time. Every document uploaded to a folder is immediately chunked and embedded, making it available for semantic search via agents.</p>
<pre><code>Upload â†’ Parse â†’ Chunk â†’ Embed â†’ Store vectors in Redis
                                   Status: 'uploaded' (RAG-ready)</code></pre>

<h3>Service B: KG Enrichment (Optional)</h3>
<p>Triggered manually via the ğŸ§  Enrich button on any non-enriched document. Extracts entities and relationships using an ontology, generates RDF triples, stores them in GraphDB, and syncs to Neo4j.</p>
<pre><code>Enrich â†’ Stage â†’ Column Map â†’ Commit â†’ Triples to GraphDB â†’ Sync to Neo4j
                                         Status: 'enriched'</code></pre>
<p>Staging data persists indefinitely in Redis (no TTL) and is cleaned up on document delete or after enrichment.</p>

<hr>

<!-- Section 7: Document Processing Pipeline -->
<h2 id="pipeline">7. Document Processing Pipeline</h2>

<h3>7.1 Upload &amp; RAG Embedding (Service A)</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚     â”‚ Upload   â”‚     â”‚ Parsers  â”‚     â”‚Chunkerâ”‚     â”‚ Redis â”‚
â”‚      â”‚     â”‚  Route   â”‚     â”‚PDF/CSV/  â”‚     â”‚  +    â”‚     â”‚Vector â”‚
â”‚      â”‚     â”‚          â”‚     â”‚Text      â”‚     â”‚Embedderâ”‚    â”‚ Store â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜
   â”‚              â”‚                â”‚               â”‚             â”‚
   â”‚ POST /upload â”‚                â”‚               â”‚             â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚             â”‚
   â”‚              â”‚  Parse file    â”‚               â”‚             â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚             â”‚
   â”‚              â”‚  Chunk + Embed â”‚               â”‚             â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
   â”‚              â”‚  Store chunk:{id} with vectors â”‚             â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚  { docId }   â”‚  Status: 'uploaded' (RAG-ready)â”‚             â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚             â”‚</code></pre>

<h3>7.2 Column Mapping (CSV/Excel)</h3>
<pre><code>{
  "property": "http://example.org#branchName",
  "propertyLabel": "branchName",
  "linkedClass": "",
  "domain": "http://example.org#Branch",
  "domainLabel": "Branch",
  "ignore": false
}</code></pre>
<ul>
  <li><code>linkedClass</code> set â†’ Object property (creates relationship)</li>
  <li><code>linkedClass</code> empty â†’ Datatype property (literal value)</li>
  <li><code>domain</code> â†’ Which entity class this literal belongs to (from <code>rdfs:domain</code>)</li>
  <li>Multi-sheet Excel: <code>sheetClassMap</code> maps each sheet to a primary class</li>
</ul>

<h3>7.3 Domain-Aware Property Routing</h3>
<pre><code>CSV Row: BranchID=BR001, BranchName="Downtown", CustomerID=CUST001, FullName="Brian Brown"

Generated Triples:
  Customer:CUST001  rdf:type        Customer .
  Customer:CUST001  hasBranch       Branch:BR001 .
  Customer:CUST001  fullName        "Brian Brown" .
  Branch:BR001      rdf:type        Branch .
  Branch:BR001      branchName      "Downtown" .     â† routed to Branch, not Customer</code></pre>

<hr>

<!-- Section 8: GraphDB â†’ Neo4j Sync -->
<h2 id="sync">8. GraphDB â†’ Neo4j Sync</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”
â”‚GraphDBâ”‚                    â”‚GraphDBNeo4jSync  â”‚                    â”‚Neo4jâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”¬â”€â”€â”˜
    â”‚  SPARQL: all instances          â”‚                                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                 â”‚
    â”‚  Bindings (batches of 10000)    â”‚                                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                 â”‚
    â”‚                                 â”‚ PASS 1: Create/merge nodes      â”‚
    â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚  SPARQL: all relationships      â”‚                                 â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                 â”‚
    â”‚                                 â”‚ PASS 2: Create relationships    â”‚
    â”‚                                 â”‚ (two directed queries â€” avoids  â”‚
    â”‚                                 â”‚  ASTCachedProperty bug)         â”‚
    â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                                 â”‚ Remove orphan nodes             â”‚
    â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</code></pre>

<hr>

<!-- Section 9: Agent Architecture -->
<h2 id="agents">9. Agent Architecture</h2>
<p>Agents are the primary conversational interface in Purple Fabric. Each agent is a configured AI persona with specific data sources, a system prompt (perspective), and optional long-term memory.</p>

<h3>9.1 Agent Configuration</h3>
<pre><code>{
  "agent_id": "uuid",
  "name": "Finance Analyst",
  "perspective": "You are a financial analyst specializing in banking data...",
  "folders": [{ "id": "folder-uuid", "name": "Finance Docs" }],
  "ontologies": [{ "id": "ont-uuid", "name": "Banking Ontology" }],
  "vkg_databases": ["mysql_banking"],
  "settings": {
    "memoryEnabled": true,
    "topK": 8,
    "graphDepth": 2
  }
}</code></pre>
<ul>
  <li><strong>Folders:</strong> Scope vector search to documents in these folders only</li>
  <li><strong>Ontologies:</strong> Guide Neo4j graph queries with ontology schema from GraphDB</li>
  <li><strong>VKG Databases:</strong> Enable federated SQL queries via Trino</li>
  <li><strong>Perspective:</strong> System prompt that shapes the agent's personality and expertise</li>
  <li><strong>Memory:</strong> Enabled by default (<code>settings.memoryEnabled !== false</code>)</li>
</ul>

<h3>9.2 Agent Chat Flow</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚     â”‚ Agent    â”‚     â”‚ Memory   â”‚     â”‚ GraphRAG     â”‚
â”‚      â”‚     â”‚ Route    â”‚     â”‚ Service  â”‚     â”‚ Service      â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚              â”‚                â”‚                   â”‚
   â”‚ POST /:id/   â”‚                â”‚                   â”‚
   â”‚ chat         â”‚                â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                   â”‚
   â”‚              â”‚ assembleMemory â”‚                   â”‚
   â”‚              â”‚ Context()      â”‚                   â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
   â”‚              â”‚ memoryContext   â”‚                   â”‚
   â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚              â”‚                â”‚                   â”‚
   â”‚              â”‚ Resolve folder-scoped doc IDs      â”‚
   â”‚              â”‚                â”‚                   â”‚
   â”‚              â”‚ unifiedAgentQuery(question, {      â”‚
   â”‚              â”‚   agent, memoryContext,             â”‚
   â”‚              â”‚   scopedDocumentIds })              â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚              â”‚                â”‚    4-Phase Pipelineâ”‚
   â”‚              â”‚ { answer, sources, metadata }      â”‚
   â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚                â”‚                   â”‚
   â”‚              â”‚ Fire-and-forget: extractMemories() â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
   â”‚  { answer }  â”‚                â”‚                   â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                   â”‚</code></pre>

<hr>

<!-- Section 10: Unified Agent Query Pipeline -->
<h2 id="unified">10. Unified Agent Query Pipeline</h2>
<p>The core intelligence of agent queries. A 4-phase pipeline that dynamically routes queries across multiple data sources.</p>

<h3>10.1 Pipeline Overview</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UNIFIED AGENT QUERY PIPELINE                     â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Phase 1  â”‚â”€â”€â–¶â”‚   Phase 2    â”‚â”€â”€â–¶â”‚ Phase 3  â”‚â”€â”€â–¶â”‚  Phase 4   â”‚  â”‚
â”‚  â”‚  PLAN    â”‚   â”‚   RETRIEVE   â”‚   â”‚  FUSE    â”‚   â”‚  GENERATE  â”‚  â”‚
â”‚  â”‚          â”‚   â”‚  (parallel)  â”‚   â”‚          â”‚   â”‚            â”‚  â”‚
â”‚  â”‚ LLM picksâ”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚ Dedupe   â”‚   â”‚ LLM builds â”‚  â”‚
â”‚  â”‚ sources, â”‚   â”‚ â”‚ Vector   â”‚â”‚   â”‚ Rank     â”‚   â”‚ answer     â”‚  â”‚
â”‚  â”‚ rewrites â”‚   â”‚ â”‚ Graph    â”‚â”‚   â”‚ Budget   â”‚   â”‚ from fused â”‚  â”‚
â”‚  â”‚ query,   â”‚   â”‚ â”‚ VKG      â”‚â”‚   â”‚ Cross-   â”‚   â”‚ context    â”‚  â”‚
â”‚  â”‚ extracts â”‚   â”‚ â”‚ Memory   â”‚â”‚   â”‚ link     â”‚   â”‚            â”‚  â”‚
â”‚  â”‚ hints    â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚          â”‚   â”‚            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>10.2 Phase 1: Query Planning (LLM-Based Source Routing)</h3>
<p>The planner receives the user's question, available data sources, a compact schema summary from GraphDB, and memory context. It returns a routing plan:</p>
<pre><code>{
  "sources": ["vector", "graph", "vkg", "memory"],
  "rewrittenQuery": "enriched query with memory context",
  "entityHints": ["Customer", "Branch"],
  "reasoning": "User asks about customer-branch relationships..."
}</code></pre>
<p>Source routing rules:</p>
<ul>
  <li><code>vector</code> â€” enabled when agent has folders (semantic search over document chunks)</li>
  <li><code>graph</code> â€” enabled when agent has folders or ontologies (Neo4j, ontology-guided)</li>
  <li><code>vkg</code> â€” enabled when agent has VKG databases configured</li>
  <li><code>memory</code> â€” always included when memory context exists</li>
  <li><code>graphdb</code> â€” NEVER included (GraphDB is schema-only, not a query target)</li>
</ul>

<h3>10.3 Phase 2: Parallel Retrieval</h3>
<p>All selected sources are queried simultaneously via <code>Promise.all</code>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PARALLEL RETRIEVAL                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Vector    â”‚  â”‚   Graph     â”‚  â”‚   VKG    â”‚  â”‚  Memory  â”‚ â”‚
â”‚  â”‚   Search    â”‚  â”‚   Query     â”‚  â”‚  Query   â”‚  â”‚  Recall  â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ Redis HNSW  â”‚  â”‚ 1. Load     â”‚  â”‚ Ontology â”‚  â”‚ Semantic â”‚ â”‚
â”‚  â”‚ KNN search  â”‚  â”‚    ontology â”‚  â”‚ â†’ SQL    â”‚  â”‚ search   â”‚ â”‚
â”‚  â”‚ (top-K,     â”‚  â”‚    from     â”‚  â”‚ â†’ Trino  â”‚  â”‚ over     â”‚ â”‚
â”‚  â”‚  min sim    â”‚  â”‚    GraphDB  â”‚  â”‚ â†’ Answer â”‚  â”‚ agent    â”‚ â”‚
â”‚  â”‚  0.15)      â”‚  â”‚ 2. Generate â”‚  â”‚          â”‚  â”‚ memories â”‚ â”‚
â”‚  â”‚             â”‚  â”‚    Cypher   â”‚  â”‚          â”‚  â”‚ (top 5)  â”‚ â”‚
â”‚  â”‚ Scoped to   â”‚  â”‚    guided   â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ agent's     â”‚  â”‚    by       â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ folder docs â”‚  â”‚    schema   â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>10.4 Phase 3: Context Fusion</h3>
<ul>
  <li><strong>Chunk deduplication:</strong> Chunks found by both vector and graph search get boosted relevance (+0.15)</li>
  <li><strong>Entity collection:</strong> Entities from Neo4j graph traversal, ranked by score</li>
  <li><strong>Memory cross-linking:</strong> If a recalled memory mentions a graph entity, that entity's score is boosted</li>
  <li><strong>VKG integration:</strong> Structured database results flagged as a separate source</li>
  <li><strong>Ranking &amp; budgeting:</strong> Chunks sorted by relevance, entities by score, capped to token budget</li>
</ul>

<h3>10.5 Phase 4: Response Generation</h3>
<p>The fused context is assembled into a prompt with the agent's perspective, core memory, recalled memories, document chunks, graph entities, and VKG results. The LLM generates a final answer citing sources.</p>

<hr>

<!-- Section 11: Agent Long-Term Memory -->
<h2 id="memory">11. Agent Long-Term Memory</h2>
<p>Agents maintain persistent memory across conversation sessions using a 3-tier architecture stored in Redis with vector search capabilities.</p>

<h3>11.1 Memory Architecture (3 Tiers)</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT MEMORY SYSTEM                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Tier 1: Core Memory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Always-present summary of the most important facts.       â”‚  â”‚
â”‚  â”‚ Updated by LLM when high-importance memories (â‰¥0.8) are   â”‚  â”‚
â”‚  â”‚ extracted. Kept under 500 words. Bullet-point format.     â”‚  â”‚
â”‚  â”‚ Stored at: agent_core:{agentId}                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Tier 2: Semantic Recall â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Individual memory entries with vector embeddings.         â”‚  â”‚
â”‚  â”‚ Searched via KNN when assembling context for a query.     â”‚  â”‚
â”‚  â”‚ Types: semantic, preference, decision, event              â”‚  â”‚
â”‚  â”‚ Stored at: agent_mem:{agentId}:{memoryId}                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Tier 3: Session History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Full conversation transcripts per session.                â”‚  â”‚
â”‚  â”‚ Used for session continuity and memory extraction.        â”‚  â”‚
â”‚  â”‚ Stored at: agent_session:{agentId}:{sessionId}            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>11.2 Memory Extraction Pipeline</h3>
<p>After every agent chat response, memories are extracted asynchronously (fire-and-forget, never blocks the response):</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MEMORY EXTRACTION PIPELINE                        â”‚
â”‚                                                                      â”‚
â”‚  User Message + Assistant Response                                   â”‚
â”‚         â”‚                                                            â”‚
â”‚         â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ LLM Extract  â”‚  "Analyze this conversation turn and extract       â”‚
â”‚  â”‚              â”‚   facts, decisions, preferences, events"           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚         â”‚                                                            â”‚
â”‚         â–¼  Array of { type, content, importance }                    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  For each extracted memory:                        â”‚
â”‚  â”‚ Consolidate  â”‚                                                    â”‚
â”‚  â”‚              â”‚  1. Search for similar existing memories (KNN)      â”‚
â”‚  â”‚              â”‚  2. LLM decides: ADD / UPDATE / NOOP               â”‚
â”‚  â”‚              â”‚     - ADD: new distinct fact â†’ store                â”‚
â”‚  â”‚              â”‚     - UPDATE: refines existing â†’ invalidate old,    â”‚
â”‚  â”‚              â”‚       store new (immutable audit trail)             â”‚
â”‚  â”‚              â”‚     - NOOP: redundant â†’ skip                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚         â”‚                                                            â”‚
â”‚         â–¼  Filter: importance â‰¥ 0.8                                  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ Update Core  â”‚  LLM rewrites the core memory block incorporating  â”‚
â”‚  â”‚ Memory       â”‚  new high-importance facts. Removes outdated info. â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>11.3 Memory Context Assembly</h3>
<pre><code>assembleMemoryContext(agentId, query):
  1. Tier 1: Load core memory block (always present)
     â†’ "[Core Memory â€” persistent knowledge:] ..."
  2. Tier 2: Semantic search over memories using query (top 5)
     â†’ "[Recalled Memories â€” relevant past context:] ..."
  3. Return combined context string (or null if empty)</code></pre>
<p>This context is injected into the planner (Phase 1) and the response generator (Phase 4).</p>

<h3>11.4 Memory Decay</h3>
<ul>
  <li><strong>Invalidation:</strong> Memories older than 90 days with importance &lt; 0.3 and access count &lt; 2 are invalidated</li>
  <li><strong>Importance reduction:</strong> Untouched memories older than 30 days have importance reduced by 10% (floor: 0.1)</li>
</ul>

<h3>11.5 Core Memory Example</h3>
<p>A user tells the agent: "I always want financial reports in EUR, not USD."</p>
<ol>
  <li><code>extractMemories()</code> â†’ LLM extracts: <code>{ type: "preference", content: "User prefers EUR", importance: 0.9 }</code></li>
  <li>Importance â‰¥ 0.8 â†’ triggers <code>_updateCoreMemory()</code></li>
  <li>LLM rewrites core memory block incorporating the new preference</li>
  <li>Next query: core memory is always injected, so the agent remembers without being told again</li>
</ol>

<h3>11.6 Memory API</h3>
<table>
  <tr><th>Endpoint</th><th>Method</th><th>Description</th></tr>
  <tr><td><code>/api/agents/:id/memories</code></td><td>GET</td><td>List memories (paginated, filterable)</td></tr>
  <tr><td><code>/api/agents/:id/memories/stats</code></td><td>GET</td><td>Memory statistics</td></tr>
  <tr><td><code>/api/agents/:id/memories/graph</code></td><td>GET</td><td>Memory knowledge graph</td></tr>
  <tr><td><code>/api/agents/:id/memories/core</code></td><td>GET/PUT</td><td>Core memory block</td></tr>
  <tr><td><code>/api/agents/:id/memories/:memId</code></td><td>PUT/DELETE</td><td>Update or invalidate a memory</td></tr>
  <tr><td><code>/api/agents/:id/memories/clear</code></td><td>POST</td><td>Clear all memories</td></tr>
  <tr><td><code>/api/agents/:id/memories/decay</code></td><td>POST</td><td>Run memory decay</td></tr>
  <tr><td><code>/api/agents/:id/memories/sessions</code></td><td>GET/POST</td><td>List or create sessions</td></tr>
  <tr><td><code>/api/agents/:id/memories/sessions/:sid</code></td><td>GET/DELETE</td><td>Get or delete session</td></tr>
</table>

<hr>

<!-- Section 12: Virtual Knowledge Graph (VKG) -->
<h2 id="vkg">12. Virtual Knowledge Graph (VKG)</h2>
<p>The VKG layer enables natural-language querying of external databases without requiring users to know SQL or the underlying schema. Ontology mappings in GraphDB define the semantic bridge between domain concepts and physical database tables.</p>

<h3>12.1 VKG Pipeline</h3>
<pre><code>"How many customers are in each branch?"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VKG QUERY PIPELINE                            â”‚
â”‚                                                                 â”‚
â”‚  Step 1: Load ontology schema + VKG mappings from GraphDB       â”‚
â”‚          Filter schema to VKG-mapped classes only                â”‚
â”‚          Resolve 2-part table names to 3-part Trino names       â”‚
â”‚                                                                 â”‚
â”‚  Step 2: LLM generates execution plan + SQL                     â”‚
â”‚          (guided by ontology + table mappings)                   â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Validate SQL offline (syntax, table references)        â”‚
â”‚                                                                 â”‚
â”‚  Step 4: Execute SQL on Trino                                   â”‚
â”‚          (retry up to 3 times with error feedback to LLM)       â”‚
â”‚                                                                 â”‚
â”‚  Step 5: Build context graph + reasoning trace                  â”‚
â”‚          (nodes = entities, edges = relationships from results) â”‚
â”‚                                                                 â”‚
â”‚  Step 6: LLM generates natural language answer from results     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>12.2 VKG Sequence Diagram</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚Agent â”‚  â”‚ VKG      â”‚  â”‚GraphDBâ”‚  â”‚   LLM    â”‚  â”‚Trinoâ”‚  â”‚Graphâ”‚
â”‚Query â”‚  â”‚ Service  â”‚  â”‚       â”‚  â”‚ Service  â”‚  â”‚     â”‚  â”‚Buildâ”‚
â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
   â”‚           â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚ question  â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ SPARQL:     â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ ontology +  â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ VKG mappingsâ”‚           â”‚           â”‚        â”‚
   â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ schema +    â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ mappings    â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ Generate plan + SQL     â”‚           â”‚        â”‚
   â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚           â”‚        â”‚
   â”‚           â”‚ { plan, sql }           â”‚           â”‚        â”‚
   â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚        â”‚
   â”‚           â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ Execute SQL â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚
   â”‚           â”‚ rows + columns          â”‚        â”‚        â”‚
   â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
   â”‚           â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ Build context graph     â”‚           â”‚        â”‚
   â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚           â”‚ { nodes, edges }        â”‚           â”‚     â”‚
   â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚           â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚           â”‚ Generate answer         â”‚           â”‚        â”‚
   â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚           â”‚        â”‚
   â”‚           â”‚ natural language answer â”‚           â”‚        â”‚
   â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚        â”‚
   â”‚ { answer, â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚   sql,    â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚   graph } â”‚             â”‚           â”‚           â”‚        â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚           â”‚           â”‚        â”‚</code></pre>

<h3>12.3 Error Recovery (3-Attempt Retry)</h3>
<pre><code>Attempt 1: LLM generates SQL â†’ Validate â†’ Execute
  âŒ Trino error: "Table not found"
Attempt 2: LLM receives error feedback â†’ Corrected SQL â†’ Validate â†’ Execute
  âŒ Validation error: "Invalid column reference"
Attempt 3: LLM receives error feedback â†’ Corrected SQL â†’ Validate â†’ Execute
  âœ… Success: 42 rows returned</code></pre>

<h3>12.4 Benefits of VKG</h3>
<table>
  <tr><th>Benefit</th><th>Description</th></tr>
  <tr><td>No SQL knowledge required</td><td>Users ask in natural language; ontology mappings handle translation</td></tr>
  <tr><td>Schema abstraction</td><td>Domain experts work with ontology concepts, not table names</td></tr>
  <tr><td>Federation</td><td>Single query can span multiple databases via Trino catalogs</td></tr>
  <tr><td>Ontology-guided accuracy</td><td>LLM generates SQL guided by formal ontology + table mappings</td></tr>
  <tr><td>Context graphs</td><td>Results visualized as entity-relationship graphs</td></tr>
  <tr><td>Reasoning traces</td><td>Step-by-step explanation of how the answer was derived</td></tr>
  <tr><td>Workspace isolation</td><td>Each workspace has its own Trino catalog configuration</td></tr>
</table>

<h3>12.5 Ontology-to-Table Mapping</h3>
<pre><code>Ontology Class: Customer
  â†’ Trino Table: mysql_banking.public.customers
  â†’ Property Mappings:
      fullName    â†’ full_name (VARCHAR)
      dateOfBirth â†’ dob (DATE)
      hasBranch   â†’ branch_id (FK â†’ branches.id)

Ontology Class: Branch
  â†’ Trino Table: mysql_banking.public.branches
  â†’ Property Mappings:
      branchName  â†’ name (VARCHAR)
      branchCode  â†’ code (VARCHAR)</code></pre>

<hr>

<!-- Section 13: Ontology Versioning -->
<h2 id="versioning">13. Ontology Versioning</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ontology Lifecycle                             â”‚
â”‚  Create â”€â”€â–¶ Edit â”€â”€â–¶ Version â”€â”€â–¶ Branch â”€â”€â–¶ Tag â”€â”€â–¶ Restore    â”‚
â”‚                                                                  â”‚
â”‚  Storage: Redis (single source of truth)                         â”‚
â”‚  GraphDB: ONE version per ontology (latest) in schema graph      â”‚
â”‚  Version snapshots: Redis at ontology_version:{ontId}:{verId}    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    main branch
                    v1 â”€â”€â”€â”€ v2 â”€â”€â”€â”€ v3 â”€â”€â”€â”€ v4 (HEAD)
                            â”‚
                            â””â”€â”€â”€â”€ experimental branch
                                  v2.1 â”€â”€â”€â”€ v2.2</code></pre>
<ul>
  <li>First version auto-tagged as <code>initial</code> on <code>main</code> branch</li>
  <li>Branches work like Git checkout â€” one active at a time per ontology</li>
  <li>Each committed document records <code>ontology_version_id</code></li>
  <li>Mapping staleness detection: compares mapping's version against current</li>
  <li>Impact analysis: shows classes/properties added/removed between versions</li>
</ul>

<hr>

<!-- Section 14: Entity Visualization -->
<h2 id="viz">14. Entity Visualization</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚Clientâ”‚     â”‚ Entity   â”‚     â”‚ Entity   â”‚     â”‚Neo4jâ”‚
â”‚Graph â”‚     â”‚  Route   â”‚     â”‚ Service  â”‚     â”‚     â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜
   â”‚              â”‚                â”‚               â”‚
   â”‚ GET /graph   â”‚                â”‚               â”‚
   â”‚ ?depth=2     â”‚                â”‚               â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚
   â”‚              â”‚ getEntityGraph â”‚               â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
   â”‚              â”‚                â”‚ BFS traversal  â”‚
   â”‚              â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚              â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚ { nodes[], edges[] }           â”‚
   â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
   â”‚  Render SVG  â”‚                â”‚               â”‚
   â”‚  â€¢ Concentric ring layout    â”‚               â”‚
   â”‚  â€¢ Directed arrows           â”‚               â”‚
   â”‚  â€¢ Curved parallel edges     â”‚               â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚</code></pre>
<p>Node IDs use composite format: <code>class::rawId</code> (e.g., <code>Customer::CUST000010</code>) to prevent collisions.</p>

<hr>

<!-- Section 15: Deployment Architecture -->
<h2 id="deploy">15. Deployment Architecture</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Compose Stack                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚  nginx   â”‚ â—€â”€â”€ Port 80/443 (public)                             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚   app    â”‚     â”‚ workers  â”‚                                      â”‚
â”‚  â”‚ (Node.js â”‚     â”‚ (BullMQ) â”‚                                      â”‚
â”‚  â”‚  :5002)  â”‚     â”‚          â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                            â”‚
â”‚       â–¼                â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ graphdb  â”‚  â”‚  neo4j   â”‚  â”‚  redis   â”‚  â”‚  trino   â”‚           â”‚
â”‚  â”‚ :7200    â”‚  â”‚  :7687   â”‚  â”‚  :6379   â”‚  â”‚  :8080   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<table>
  <tr><th>Service</th><th>Image</th><th>Health Check</th></tr>
  <tr><td>graphdb</td><td>ontotext/graphdb:10.7.3</td><td>REST API <code>/rest/repositories</code></td></tr>
  <tr><td>neo4j</td><td>neo4j:5</td><td><code>cypher-shell RETURN 1</code></td></tr>
  <tr><td>redis</td><td>redis/redis-stack-server:7.4.0-v2</td><td><code>redis-cli ping</code></td></tr>
  <tr><td>trino</td><td>trinodb/trino</td><td>HTTP <code>/v1/info</code></td></tr>
  <tr><td>app</td><td>iaikunal/enterprise-kg:latest</td><td>â€”</td></tr>
</table>

<hr>

<!-- Section 16: Client Architecture -->
<h2 id="client">16. Client Architecture</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     React SPA (CRA)                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Contexts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AuthContext (JWT, login/logout, token refresh)             â”‚  â”‚
â”‚  â”‚ TenantContext (workspace selection, tenant headers)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Pages / Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  ğŸ¤– Agents                                                â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ Agent creation (name, perspective, data sources)  â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ Agent chat with unified query pipeline            â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ Source badges (vector, graph, vkg, memory)        â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ Memory panel (stats, graph, core memory editor)   â”‚  â”‚
â”‚  â”‚     â””â”€â”€ Context graph visualization (VKG results)         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  ğŸ“ Data Management                                       â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ FileManager (folders, documents, chunks, mapping) â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ ğŸ§  Enrich button (inline on non-enriched docs)   â”‚  â”‚
â”‚  â”‚     â””â”€â”€ EntitiesPage (entity registry + graph view)       â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  ğŸ“š Ontologies                                            â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ OntologiesPage (list, create, import)             â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ EnhancedOntologyEditor (visual editor)            â”‚  â”‚
â”‚  â”‚     â””â”€â”€ OntologyVersioningModal (version history)         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  ğŸ”§ Administration                                        â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ DatabaseManager (Neo4j, GraphDB, Redis status)    â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ Users / Tenants / Roles management                â”‚  â”‚
â”‚  â”‚     â””â”€â”€ Settings (system configuration)                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<hr>

<!-- Section 17: Service Dependency Graph -->
<h2 id="deps">17. Service Dependency Graph</h2>
<pre><code>                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   llmService    â”‚
                        â”‚ (Bedrock/OpenAI/â”‚
                        â”‚  Ollama)        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                           â”‚                           â”‚
     â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚extractionSvc â”‚  â”‚  graphRAGService    â”‚  â”‚  vkgQueryService    â”‚
â”‚              â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚â€¢ chunkingSvc â”‚  â”‚â€¢ vectorStoreService â”‚  â”‚â€¢ vkgOntologyService â”‚
â”‚â€¢ embeddingSvcâ”‚  â”‚â€¢ neo4jService       â”‚  â”‚â€¢ sqlValidatorServiceâ”‚
â”‚â€¢ conceptExt  â”‚  â”‚â€¢ memoryService      â”‚  â”‚â€¢ trinoManager       â”‚
â”‚â€¢ tripleSvc   â”‚  â”‚â€¢ vkgQueryService    â”‚  â”‚â€¢ contextGraphBuilderâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                        â”‚
       â–¼                     â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GraphDB    â”‚  â”‚    Redis     â”‚  â”‚    Neo4j     â”‚  â”‚  Trino   â”‚
â”‚(Ontology)    â”‚  â”‚(Vectors/Mem) â”‚  â”‚(Entity Query)â”‚  â”‚(Fed. SQL)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<hr>

<!-- Section 18: Security Architecture -->
<h2 id="security">18. Security Architecture</h2>
<table>
  <tr><th>Layer</th><th>Mechanism</th></tr>
  <tr><td>Transport</td><td>HTTPS via nginx SSL termination (Let's Encrypt)</td></tr>
  <tr><td>Authentication</td><td>JWT Bearer tokens (24h expiry) + refresh tokens (7d)</td></tr>
  <tr><td>CSRF</td><td><code>X-Requested-With: XMLHttpRequest</code> header required</td></tr>
  <tr><td>Authorization</td><td>RBAC with 4-tier role hierarchy and 26 granular permissions</td></tr>
  <tr><td>Rate Limiting</td><td>200 requests/minute per user/IP</td></tr>
  <tr><td>Input Validation</td><td>LLM output validator, prompt sanitizer, SQL validation</td></tr>
  <tr><td>Audit</td><td>Activity logger captures all API requests</td></tr>
  <tr><td>Tenant Isolation</td><td>Named graphs (GraphDB), node properties (Neo4j), key prefixes (Redis), catalog scoping (Trino)</td></tr>
</table>

<hr>

<!-- Section 19: Background Job Processing -->
<h2 id="jobs">19. Background Job Processing</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BullMQ (Redis-backed)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  extraction    â”‚  â”‚   commit       â”‚  â”‚  schema-       â”‚     â”‚
â”‚  â”‚  queue         â”‚  â”‚   queue        â”‚  â”‚  analysis      â”‚     â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚  queue         â”‚     â”‚
â”‚  â”‚ â€¢ Parse doc    â”‚  â”‚ â€¢ Gen triples  â”‚  â”‚ â€¢ LLM analyze  â”‚     â”‚
â”‚  â”‚ â€¢ LLM extract  â”‚  â”‚ â€¢ Store GraphDBâ”‚  â”‚ â€¢ Suggest      â”‚     â”‚
â”‚  â”‚ â€¢ Embed chunks â”‚  â”‚ â€¢ Sync Neo4j   â”‚  â”‚   classes      â”‚     â”‚
â”‚  â”‚ â€¢ Store vectorsâ”‚  â”‚                â”‚  â”‚                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Job lifecycle: pending â†’ active â†’ completed/failed              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<hr>

<!-- Section 20: Key Design Decisions -->
<h2 id="decisions">20. Key Design Decisions</h2>
<table>
  <tr><th>Decision</th><th>Rationale</th></tr>
  <tr><td>GraphDB as ontology/schema store only</td><td>Provides formal semantics and SPARQL for schema management; not queried for answers</td></tr>
  <tr><td>Neo4j as entity query engine</td><td>Optimized for graph traversal; guided by ontology from GraphDB</td></tr>
  <tr><td>Redis for vectors + memory</td><td>RediSearch HNSW for sub-millisecond semantic search on chunks and memories</td></tr>
  <tr><td>Trino for federated SQL</td><td>Enables querying external databases; ontology mappings abstract the schema</td></tr>
  <tr><td>Two independent services (RAG + KG)</td><td>RAG is immediate at upload; KG enrichment is optional and manual</td></tr>
  <tr><td>LLM-based query planner</td><td>Dynamically routes queries to the right sources based on question semantics</td></tr>
  <tr><td>3-tier agent memory</td><td>Core memory (always present) + semantic recall (query-relevant) + session history</td></tr>
  <tr><td>Async memory extraction</td><td>Never blocks chat responses; fire-and-forget with <code>setImmediate</code></td></tr>
  <tr><td>Memory consolidation via LLM</td><td>Prevents duplicates; LLM decides ADD/UPDATE/NOOP for each fact</td></tr>
  <tr><td>Staging data persists indefinitely</td><td>No TTL â€” cleaned up on doc delete or after enrichment</td></tr>
  <tr><td>Domain-aware property routing</td><td>Literal properties attach to the correct entity based on <code>rdfs:domain</code></td></tr>
  <tr><td>VKG retry with error feedback</td><td>Up to 3 attempts with LLM receiving error context for self-correction</td></tr>
  <tr><td>MIN_SIMILARITY 0.15</td><td>Lowered from 0.3 to avoid filtering out results for vague queries</td></tr>
</table>

<hr>

<p style="color: var(--text-secondary); font-size: 13px; margin-top: 40px;">
  <em>Document generated from codebase analysis â€” Version 3.0, February 2026. For API reference, see <code>/api-docs</code> (Swagger UI).</em>
</p>

</body>
</html>
